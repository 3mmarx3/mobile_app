<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>شوب أدمن - إدارة الفئات</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="../style/style.css">

</head>
<body>

    <header id="header">
        
    </header>

    <div class="main-content">
        <div class="header d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center gap-3">
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                <h2 class="mb-0" id="page-title">إدارة الفئات</h2>
            </div>
            <div class="user-info">
                <span>مرحباً، <strong>المشرف العام</strong></span>
                <img src="https://ui-avatars.com/api/?name=المشرف+العام&background=6366f1&color=fff" alt="المشرف">
            </div>
        </div>

        <div id="page-container">
      
            <div id="categories" class="page active">
                <div class="container-fluid">
                    <div class="d-flex justify-content-between align-items-center mb-4 page-header">
                        <h2 class="mb-0">جميع الفئات (18)</h2>
                        <button class="btn btn-custom btn-primary" onclick="openAddCategoryModal()">إضافة فئة جديدة</button>
                    </div>

                    <div class="card-custom">
                        <div class="table-responsive table-responsive-custom">
                            <table class="table table-custom">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" id="selectAllTop"></th>
                                        <th>الصورة</th>
                                        <th>الاسم</th>
                                        <th>الرابط</th>
                                        <th>المنتجات</th>
                                        <th>الحالة</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="categoriesTable">
                                    <tr>
                                        <td><input type="checkbox" class="row-check"></td>
                                        <td><img src="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=200&h=200&fit=crop" class="category-img" alt="الهواتف الذكية"></td>
                                        <td><strong>الهواتف الذكية</strong></td>
                                        <td>smartphones</td>
                                        <td><span class="badge badge-custom badge-count">42</span></td>
                                        <td><span class="badge badge-custom active">منشور</span></td>
                                        <td>
                                            <a href="#" class="edit" onclick="openEditCategoryModal(this,'الهواتف الذكية','smartphones','https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=200&h=200&fit=crop',42,true)"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
  <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
  <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>
</svg></a>
                                            <a href="#" class="delete "   onclick="if(confirm('حذف؟')) this.closest('tr').remove()">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-octagon" viewBox="0 0 16 16">
  <path d="M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1z"/>
  <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
</svg>
                                            </a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="modal modal-custom fade" id="categoryModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="catModalTitle">إضافة فئة جديدة</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="form-group mb-3">
                                    <label class="form-label">اسم الفئة *</label>
                                    <input type="text" id="catName" class="form-control" required>
                                </div>
                                <div class="form-group mb-3">
                                    <label class="form-label">الرابط (URL)</label>
                                    <input type="text" id="catSlug" class="form-control">
                                </div>
                                <div class="form-group mb-3">
                                    <label class="form-label">صورة الفئة *</label>
                                    <div class="image-upload" id="dropZone">
                                        <i class="fas fa-cloud-upload-alt fa-3x mb-2" style="color:#94a3b8;"></i>
                                        <p class="mb-2" style="color:#64748b;font-weight:600;">انقر للرفع أو اسحب وأفلت</p>
                                        <p style="color:#94a3b8;font-size:0.9rem;">PNG, JPG, WebP حتى 2MB</p>
                                        <input type="file" id="catImage" accept="image/*" style="display:none">
                                    </div>
                                    <div class="image-preview mt-3" id="imagePreview" style="display:none;text-align:center;position:relative;">
                                        <img id="previewImg" src="" alt="معاينة" style="max-width:200px;border-radius:8px;">
                                        <button class="remove-img" onclick="removeCatImage()">×</button>
                                    </div>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="catStatus" checked>
                                    <label class="form-check-label" for="catStatus">
                                        نشر الفئة
                                    </label>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                                <button type="button" class="btn btn-primary" onclick="saveCategory()">حفظ الفئة</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../app/header.js"></script>
    <script>
        function saveToLocalStorage(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        function getFromLocalStorage(key) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        }

        const categoryModal = new bootstrap.Modal(document.getElementById('categoryModal'));
        
        document.getElementById('mobileMenuBtn').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('active');
        });

        document.addEventListener('click', (e) => {
            const sidebar = document.getElementById('sidebar');
            const mobileBtn = document.getElementById('mobileMenuBtn');

            if (window.innerWidth < 992 && 
                sidebar &&
                sidebar.classList.contains('active') && 
                !sidebar.contains(e.target) && 
                e.target !== mobileBtn && 
                !mobileBtn.contains(e.target)) {
                sidebar.classList.remove('active');
            }
        });

        function logout() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                localStorage.removeItem('adminLoggedIn');
                window.location.href = './auth/login.html'; 
            }
            return false;
        }

        let currentEditRow = null;
        
        function openAddCategoryModal() {
            document.getElementById('catModalTitle').textContent = 'إضافة فئة جديدة';
            document.getElementById('catName').value = '';
            document.getElementById('catSlug').value = '';
            document.getElementById('catStatus').checked = true;
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('catImage').value = ''; 
            currentEditRow = null;
            categoryModal.show();
        }

        function openEditCategoryModal(btn, name, slug, img, count, status) {
            document.getElementById('catModalTitle').textContent = 'تعديل الفئة';
            document.getElementById('catName').value = name;
            document.getElementById('catSlug').value = slug;
            document.getElementById('catStatus').checked = status;
            document.getElementById('previewImg').src = img;
            document.getElementById('imagePreview').style.display = 'block';
            document.getElementById('catImage').value = '';
            currentEditRow = btn.closest('tr');
            categoryModal.show();
        }

        function removeCatImage() {
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('catImage').value = '';
        }

        function saveCategory() {
            const name = document.getElementById('catName').value.trim();
            const slug = document.getElementById('catSlug').value || name.toLowerCase().replace(/ /g,'-');
            const img = document.getElementById('previewImg').src || 'https://via.placeholder.com/200';
            const status = document.getElementById('catStatus').checked;
            
            if (!name) {
                alert('اسم الفئة مطلوب!');
                return;
            }
            
            if (!currentEditRow) {
                const row = document.querySelector('#categoriesTable').insertRow(0);
                row.innerHTML = `
                    <td><input type="checkbox" class="row-check"></td>
                    <td><img src="${img}" class="category-img" alt="${name}"></td>
                    <td><strong>${name}</strong></td>
                    <td>${slug}</td>
                    <td><span class="badge badge-custom badge-count">0</span></td>
                    <td><span class="badge badge-custom ${status?'active':'draft'}">${status?'منشور':'مسودة'}</span></td>
                    <td>
                        <a href="#" class="edit" onclick="openEditCategoryModal(this,'${name}','${slug}','${img}',0,${status})"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/></svg></a>
                        <a href="#" class="delete " onclick="if(confirm('حذف؟')) this.closest('tr').remove()"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-octagon" viewBox="0 0 16 16"><path d="M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1z"/><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg></a>
                    </td>
                `;
            } else {
                currentEditRow.cells[2].innerHTML = `<strong>${name}</strong>`;
                currentEditRow.cells[3].textContent = slug;
                currentEditRow.cells[1].innerHTML = `<img src="${img}" class="category-img" alt="${name}">`;
                currentEditRow.cells[5].innerHTML = `<span class="badge badge-custom ${status?'active':'draft'}">${status?'منشور':'مسودة'}</span>`;
                const editLink = currentEditRow.querySelector('.edit');
                editLink.setAttribute('onclick', `openEditCategoryModal(this,'${name}','${slug}','${img}',${currentEditRow.cells[4].textContent},${status})`);
            }

            alert('تم حفظ الفئة!');
            categoryModal.hide();
        }

        document.getElementById('dropZone').addEventListener('click', () => document.getElementById('catImage').click());
        
        document.getElementById('catImage').addEventListener('change', e => {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = ev => {
                    document.getElementById('previewImg').src = ev.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        document.getElementById('selectAllTop').addEventListener('click', () => {
            const isChecked = document.getElementById('selectAllTop').checked;
            document.querySelectorAll('.row-check').forEach(cb => cb.checked = isChecked);
        });

        window.addEventListener('resize', () => {
            if (window.innerWidth >= 992) {
                const sidebar = document.getElementById('sidebar');
                if (sidebar) {
                    sidebar.classList.remove('active');
                }
            }
        });

  
    </script>
</body>
</html>